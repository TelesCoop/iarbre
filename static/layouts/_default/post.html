{{ define "main" }}

<div class="article-page">
  {{ if .Params.image }}
  <div class="article-hero">
    {{ $img := .Resources.GetMatch .Params.image }} {{ if $img }}
    <img
      src="{{ $img.RelPermalink }}"
      alt="{{ $.Title }}"
      class="article-hero-img"
    />
    {{ else }}
    <img
      src="{{ .Params.image }}"
      alt="{{ $.Title }}"
      class="article-hero-img"
    />
    {{ end }}
    <div class="article-hero-overlay"></div>
  </div>
  {{ end }}

  <div class="article-container">
    <article class="article-main">
      <header class="article-header">
        <a href="/actualites/" class="article-back">← Actualités</a>

        <h1 class="article-title">{{ .Title }}</h1>

        <div class="article-meta">
          <div class="article-meta-author">
            <span class="meta-author-name">{{ .Params.Author }}</span>
          </div>
          <div class="article-meta-details">
            <span class="meta-date"
              >{{ .PublishDate | time.Format "02 January 2006" }}</span
            >
            <span class="meta-separator">·</span>
            <span class="meta-reading"
              >{{ math.Round (div (countwords .Content) 200.0) }} min de
              lecture</span
            >
          </div>
        </div>
      </header>

      <div class="article-content">{{ .Content }}</div>
    </article>

    {{ $currentPage := . }} {{ $posts := sort (where site.RegularPages.ByTitle
    "Section" "actualites") ".PublishDate" }} {{ $recentPosts := first 3 (where
    ($posts.Reverse) "Permalink" "!=" $currentPage.Permalink) }} {{ if gt (len
    $recentPosts) 0 }}
    <section class="related-articles-section">
      <div class="section-header">
        <h2 class="section-title">À lire également</h2>
      </div>

      <div class="related-articles-grid">
        {{ range $recentPosts }}
        <a href="{{ .RelPermalink }}" class="related-article-card">
          {{ if .Params.image }}
          <div class="related-article-image">
            {{ $img := .Resources.GetMatch .Params.image }} {{ if $img }}
            <img src="{{ $img.RelPermalink }}" alt="{{ .Title }}" />
            {{ else }}
            <img src="{{ .Params.image }}" alt="{{ .Title }}" />
            {{ end }}
          </div>
          {{ end }}
          <div class="related-article-content">
            <span class="related-article-date"
              >{{ .PublishDate | time.Format "02 Jan 2006" }}</span
            >
            <h3 class="related-article-title">{{ .Title }}</h3>
            <span class="related-article-cta">Lire →</span>
          </div>
        </a>
        {{ end }}
      </div>

      <div class="back-to-news">
        <a href="/actualites/" class="back-link"
          >Voir toutes les actualités →</a
        >
      </div>
    </section>
    {{ else }}
    <div class="back-to-news standalone">
      <a href="/actualites/" class="back-link">← Retour aux actualités</a>
    </div>
    {{ end }}
  </div>
</div>

{{ end }}
