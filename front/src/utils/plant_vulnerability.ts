import { PLANTABILITY_COLOR_MAP } from "./plantability"

export const PLANT_VULNERABILITY_BIVARIATE_COLOR_MAP: {
  [plantability: number]: { [vulnerability: number]: string }
} = {
  0: {
    1: "#B0B0B0",
    2: "#A8A8A8",
    3: "#A0A0A0",
    4: "#989898",
    5: "#909090"
  },

  1: {
    1: "#BF5A16",
    2: "#B85A1A",
    3: "#B8541E",
    4: "#B84E22",
    5: "#B83632"
  },

  2: {
    1: "#DDAD14",
    2: "#D8A518",
    3: "#D39D1C",
    4: "#CE9520",
    5: "#BA7530"
  },

  3: {
    1: "#A6CC4A",
    2: "#A4C84E",
    3: "#A2C452",
    4: "#9EBC5A",
    5: "#98B066"
  },

  4: {
    1: "#55B250",
    2: "#52AE4D",
    3: "#4FAA4A",
    4: "#4CA647",
    5: "#40963B"
  }
}

export function getBivariateColor(plantabilityScore: number, vulnerabilityScore: number): string {
  // Map plantability from 0-10 scale to 0-4 scale
  const plantability = Math.min(4, Math.max(0, Math.round(plantabilityScore / 2.5)))

  // Map vulnerability from 1-9 scale to 1-5 scale
  const vulnerability = Math.min(5, Math.max(1, Math.round(((vulnerabilityScore - 1) / 8) * 4) + 1))

  return PLANT_VULNERABILITY_BIVARIATE_COLOR_MAP[plantability]?.[vulnerability] || "#C4C4C4"
}

//MapLibre GL expression for bivariate mapping with 5x5 grid
export function generateBivariateColorExpression(): any[] {
  const expression: any[] = [
    "case",

    ["!=", ["get", "vulnerability_indice_day"], null],
    [
      "case",

      ["<=", ["get", "vulnerability_indice_day"], 2],
      [
        "case",
        ["<=", ["get", "indice"], 2],
        "#B0B0B0",
        ["<=", ["get", "indice"], 4],
        "#BF5A16",
        ["<=", ["get", "indice"], 6],
        "#DDAD14",
        ["<=", ["get", "indice"], 8],
        "#A6CC4A",
        "#55B250"
      ],

      ["<=", ["get", "vulnerability_indice_day"], 4],
      [
        "case",
        ["<=", ["get", "indice"], 2],
        "#A0A0A0",
        ["<=", ["get", "indice"], 4],
        "#B8541E",
        ["<=", ["get", "indice"], 6],
        "#D39D1C",
        ["<=", ["get", "indice"], 8],
        "#A2C452",
        "#4FAA4A"
      ],

      ["<=", ["get", "vulnerability_indice_day"], 6],
      [
        "case",
        ["<=", ["get", "indice"], 2],
        "#989898",
        ["<=", ["get", "indice"], 4],
        "#B84E22",
        ["<=", ["get", "indice"], 6],
        "#CE9520",
        ["<=", ["get", "indice"], 8],
        "#9EBC5A",
        "#4CA647"
      ],

      ["<=", ["get", "vulnerability_indice_day"], 8],
      [
        "case",
        ["<=", ["get", "indice"], 2],
        "#909090",
        ["<=", ["get", "indice"], 4],
        "#B83632",
        ["<=", ["get", "indice"], 6],
        "#BA7530",
        ["<=", ["get", "indice"], 8],
        "#98B066",
        "#40963B"
      ],

      [
        "case",
        ["<=", ["get", "indice"], 2],
        "#909090",
        ["<=", ["get", "indice"], 4],
        "#B83632",
        ["<=", ["get", "indice"], 6],
        "#BA7530",
        ["<=", ["get", "indice"], 8],
        "#98B066",
        "#40963B"
      ]
    ],
    ["match", ["get", "indice"], ...PLANTABILITY_COLOR_MAP]
  ]

  return expression
}
