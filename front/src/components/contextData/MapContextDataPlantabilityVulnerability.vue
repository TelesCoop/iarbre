<script lang="ts" setup>
import { computed } from "vue"
import type { PlantabilityVulnerabilityData } from "@/types/vulnerability_plantability"
import ContextDataMainContainer from "@/components/contextData/shared/ContextDataMainContainer.vue"

interface PlantVulnerabilityCardProps {
  data?: PlantabilityVulnerabilityData | null
}

const props = withDefaults(defineProps<PlantVulnerabilityCardProps>(), {
  data: null
})

const currentData = computed<PlantabilityVulnerabilityData | null>(() => props.data)

const metrics = computed(() => [
  {
    key: "plantability",
    label: "Score de plantabilit√©",
    value: currentData.value?.plantabilityNormalizedIndice?.toFixed(1) ?? "0",
    icon: "üå≥",
    unit: "/10",
    type: "positive"
  },
  {
    key: "vulnerability_day",
    label: "Vuln√©rabilit√© jour",
    value: currentData.value?.vulnerabilityIndiceDay?.toFixed(1) ?? "0",
    icon: "‚òÄÔ∏è",
    unit: "/9",
    type: "negative"
  },
  {
    key: "vulnerability_night",
    label: "Vuln√©rabilit√© nuit",
    value: currentData.value?.vulnerabilityIndiceNight?.toFixed(1) ?? "0",
    icon: "üåô",
    unit: "/9",
    type: "negative"
  }
])
</script>

<template>
  <ContextDataMainContainer
    color-scheme="plantability"
    title="plantability_vulnerability"
    description="Croisement du score de plantabilit√© et de la vuln√©rabilit√© √† la chaleur."
    :data="currentData"
    empty-message="Zoomez et cliquez sur un carreau"
  >
    <template #content>
      <table class="metrics-table">
        <tbody>
          <tr
            v-for="(metric, index) in metrics"
            :key="metric.key"
            :class="{ 'row-border': index < metrics.length - 1 }"
          >
            <td class="cell-icon">{{ metric.icon }}</td>
            <td class="cell-label">{{ metric.label }}</td>
            <td :class="['cell-value', `type-${metric.type}`]">
              {{ metric.value }}
              <span class="value-unit">{{ metric.unit }}</span>
            </td>
          </tr>
        </tbody>
      </table>
    </template>
  </ContextDataMainContainer>
</template>

<style scoped>
@reference "@/styles/main.css";

.metrics-table {
  @apply w-full border-separate border-spacing-0;
  @apply bg-gray-50 rounded-lg border border-gray-200 overflow-hidden;
}

.row-border {
  @apply border-b border-gray-100;
}

.metrics-table td {
  @apply py-3 px-3 align-middle;
}

.cell-icon {
  @apply w-8 text-center text-base;
}

.cell-label {
  @apply text-sm text-gray-600 font-medium;
}

.cell-value {
  @apply text-right text-sm font-semibold whitespace-nowrap tabular-nums;
}

.cell-value.type-positive {
  @apply text-primary-600;
}

.cell-value.type-negative {
  @apply text-orange-500;
}

.value-unit {
  @apply text-xs font-normal text-gray-400 ml-0.5;
}
</style>
