<script lang="ts" setup>
import { computed, withDefaults } from "vue"
import type { PlantabilityVulnerabilityData } from "@/types/vulnerability_plantability"
import type { ContextDataFactor } from "@/types/contextData"
import ContextDataMainContainer from "@/components/contextData/shared/ContextDataMainContainer.vue"
import ContextDataItem from "@/components/contextData/shared/ContextDataItem.vue"

interface PlantVulnerabilityCardProps {
  data?: PlantabilityVulnerabilityData[]
}

const props = withDefaults(defineProps<PlantVulnerabilityCardProps>(), {
  data: () => []
})

// Les donn√©es sont soit une seule tuile, soit des donn√©es pr√©-agr√©g√©es du backend
const currentData = computed<PlantabilityVulnerabilityData | null>(() => {
  if (!props.data || props.data.length === 0) return null
  return props.data[0]
})

const plantabilityItem = computed(
  (): ContextDataFactor => ({
    key: "plantability",
    label: "Score de plantabilit√©",
    value: currentData.value?.plantabilityNormalizedIndice?.toFixed(1) ?? "0",
    icon: "üå≥",
    unit: "/10",
    impact: "positive"
  })
)

const vulnerabilityDayItem = computed(
  (): ContextDataFactor => ({
    key: "vulnerability_day",
    label: "Vuln√©rabilit√© jour",
    value: currentData.value?.vulnerabilityIndiceDay?.toFixed(1) ?? "0",
    icon: "‚òÄÔ∏è",
    unit: "/9",
    impact: "negative"
  })
)

const vulnerabilityNightItem = computed(
  (): ContextDataFactor => ({
    key: "vulnerability_night",
    label: "Vuln√©rabilit√© nuit",
    value: currentData.value?.vulnerabilityIndiceNight?.toFixed(1) ?? "0",
    icon: "üåô",
    unit: "/9",
    impact: "negative"
  })
)
</script>

<template>
  <context-data-main-container
    color-scheme="plantability"
    title="plantability_vulnerability"
    description="Croisement du score de plantabilit√© et de la vuln√©rabilit√© √† la chaleur."
    :data="currentData"
    empty-message="Zoomez et cliquez sur un carreau"
  >
    <template #content>
      <div class="space-y-2">
        <context-data-item :item="plantabilityItem" color-scheme="plantability" />

        <context-data-item :item="vulnerabilityDayItem" color-scheme="plantability" />

        <context-data-item :item="vulnerabilityNightItem" color-scheme="plantability" />
      </div>
    </template>
  </context-data-main-container>
</template>
