<script lang="ts" setup>
import type { VulnerabilityData } from "@/types/vulnerability"
import { useVulnerability } from "@/composables/useVulnerabilityData"
import { toRef } from "vue"
import EmptyMessage from "@/components/EmptyMessage.vue"

interface VulnerabilityDataProps {
  data: VulnerabilityData
}

const props = defineProps<VulnerabilityDataProps>()
const emit = defineEmits<{
  close: []
}>()

const handleClose = () => {
  emit("close")
}

const { factorsWithScores, getScoreColor, getScoreLabel, colorLegend, getFactorDescription } =
  useVulnerability(toRef(props, "data"))
</script>

<template>
  <div
    aria-describedby="vulnerability-description"
    aria-labelledby="vulnerability-title"
    class="map-context-panel"
    role="dialog"
  >
    <map-context-header title="Vulnérabilité à la chaleur" @close="handleClose" />
    <div class="map-context-panel-content">
      <vulnerability-context-data-table
        v-if="factorsWithScores.length"
        :factors-with-scores="factorsWithScores"
        :get-factor-description="getFactorDescription"
        :get-score-color="getScoreColor"
        :get-score-label="getScoreLabel"
      />
      <empty-message v-else data-cy="empty-message" message="Aucune donnée connue" />
      <vulnerability-context-data-legend :color-legend="colorLegend" />
    </div>
  </div>
</template>

<script lang="ts" setup></script>
