<script lang="ts" setup>
import { computed, withDefaults } from "vue"
import type { PlantabilityVulnerabilityData } from "@/types/vuln_plantability"
import type { ContextDataFactor } from "@/types/contextData"
import ContextDataMainContainer from "@/components/contextData/shared/ContextDataMainContainer.vue"
import ContextDataItem from "@/components/contextData/shared/ContextDataItem.vue"

interface PlantVulnerabilityCardProps {
  data?: PlantabilityVulnerabilityData | null
}

const props = withDefaults(defineProps<PlantVulnerabilityCardProps>(), {
  data: null
})

const plantabilityItem = computed(
  (): ContextDataFactor => ({
    key: "plantability",
    label: "Score de plantabilité",
    value: props.data?.plantabilityNormalizedIndice?.toFixed(0) ?? "0",
    icon: "🌳",
    unit: "/10",
    impact: "positive"
  })
)

const vulnerabilityDayItem = computed(
  (): ContextDataFactor => ({
    key: "vulnerability_day",
    label: "Vulnérabilité jour",
    value: props.data?.vulnerability_indice_day?.toFixed(0) ?? "0",
    icon: "☀️",
    unit: "/9",
    impact: "negative"
  })
)

const vulnerabilityNightItem = computed(
  (): ContextDataFactor => ({
    key: "vulnerability_night",
    label: "Vulnérabilité nuit",
    value: props.data?.vulnerability_indice_night?.toFixed(0) ?? "0",
    icon: "🌙",
    unit: "/9",
    impact: "negative"
  })
)
</script>

<template>
  <context-data-main-container
    color-scheme="plantability"
    title="plant_vulnerability"
    description="Croisement du score de plantabilité et de la vulnérabilité à la chaleur."
    :data="props.data"
    empty-message="Zoomez et cliquez sur un carreau"
  >
    <template #content>
      <div class="space-y-2">
        <context-data-item :item="plantabilityItem" color-scheme="plantability" />

        <context-data-item :item="vulnerabilityDayItem" color-scheme="plantability" />

        <context-data-item :item="vulnerabilityNightItem" color-scheme="plantability" />
      </div>
    </template>
  </context-data-main-container>
</template>
