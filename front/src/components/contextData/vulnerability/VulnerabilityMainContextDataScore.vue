<script lang="ts" setup>
import { computed } from "vue"
import { getVulnerabilityColor } from "@/utils/vulnerability"

interface VulnerabilityMainScoreProps {
  score: number
  percentage: number
  name: string
}

const props = defineProps<VulnerabilityMainScoreProps>()

const textColor = computed(() => {
  if (!props.score) return "text-gray-300"
  const colorCode = getVulnerabilityColor(props.score)
  const colorMap: Record<string, string> = {
    "#4474b5": "text-blue-600",
    "#75add1": "text-blue-400",
    "#aad9e9": "text-blue-200",
    "#5aaf7b": "text-green-600",
    "#9cbf4e": "text-green-500",
    "#d7e360": "text-green-300",
    "#fdae60": "text-orange-300",
    "#f56c43": "text-orange-500",
    "#d73026": "text-red-600",
    grey: "text-gray-500"
  }
  return colorMap[colorCode] || "text-gray-500"
})
</script>

<template>
  <section class="text-center" aria-labelledby="score-section">
    <h3 id="score-section" class="sr-only">Score de vulnérabilité {{ name }}</h3>

    <div class="relative inline-block">
      <circular-progress
        :percentage="percentage"
        :background-color="textColor"
        :aria-label="`Score de vulnérabilité en journée : ${score} sur 9`"
        data-cy="circular-progress"
      />

      <div class="absolute inset-0 flex flex-col items-center justify-center">
        <span class="text-sm text-gray-600">{{ name }}:</span>
        <span
          class="text-xl md:text-3xl font-bold"
          :class="textColor"
          data-cy="vulnerability-score"
        >
          {{ score }}/9
        </span>
      </div>
    </div>
  </section>
</template>
