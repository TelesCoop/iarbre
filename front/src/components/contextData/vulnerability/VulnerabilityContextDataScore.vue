<script lang="ts" setup>
import { computed } from "vue"

const props = defineProps<{
  score: number | null
  factorId: string
  getScoreColor: (score: number, factorId: string) => string
  getScoreLabel: (score: number, factorId: string) => string
}>()

const tooltipText = computed(() => {
  if (props.score === null) return "Aucune donnée disponible"
  const label = props.getScoreLabel(props.score, props.factorId)
  return `Impact: ${label} (Score: ${props.score})`
})

const isHighImpact = computed(() => {
  return props.score !== null && Math.abs(props.score) >= 3
})
</script>

<template>
  <div class="relative group" data-cy="vulnerability-context-data-score">
    <div
      v-if="score !== null"
      v-tooltip.top="tooltipText"
      :class="[
        getScoreColor(score, factorId),
        'relative flex items-center justify-center w-6 h-6 sm:w-8 sm:h-8 rounded-full shadow-md transform hover:scale-110 transition-all duration-200 cursor-pointer border-2 border-white'
      ]"
      :data-cy="`vulnerability-context-data-${score}`"
    >
      <!-- Pas d'affichage du score numérique -->

      <!-- Indicateur d'impact élevé -->
      <div
        v-if="isHighImpact"
        class="absolute -top-0.5 -right-0.5 sm:-top-1 sm:-right-1 w-2 h-2 sm:w-3 sm:h-3 bg-yellow-400 rounded-full border border-white flex items-center justify-center"
      >
        <span class="text-yellow-800 text-2xs sm:text-xs font-bold">!</span>
      </div>
    </div>

    <div
      v-else
      v-tooltip.top="tooltipText"
      class="w-6 h-6 sm:w-8 sm:h-8 bg-gray-100 rounded-full border-2 border-gray-200 flex items-center justify-center cursor-help"
    >
      <span class="text-gray-400 text-2xs sm:text-xs font-medium">-</span>
    </div>
  </div>
</template>
