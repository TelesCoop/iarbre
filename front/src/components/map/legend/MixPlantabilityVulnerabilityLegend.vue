<script lang="ts" setup>
import { useMapStore } from "@/stores/map"

const mapStore = useMapStore()

const handleScoreClick = (score: number) => {
  mapStore.toggleAndApplyFilter(score)
}

const SCORE_BG_CLASSES: Record<number, string> = {
  0: "bg-scale-0",
  1: "bg-scale-1",
  2: "bg-scale-2",
  3: "bg-scale-3",
  4: "bg-scale-4",
  5: "bg-scale-5",
  6: "bg-scale-6",
  7: "bg-scale-7",
  8: "bg-scale-8",
  9: "bg-scale-9",
  10: "bg-scale-10"
}
</script>

<template>
  <div
    class="font-accent flex flex-col items-center justify-center text-xs leading-3 gap-4"
    data-cy="mix-plantability-vulnerability-legend"
  >
    <!-- Plantability Legend Section -->
    <div class="flex flex-col items-center gap-2">
      <div class="text-sm font-semibold text-primary-900">Plantabilité</div>
      <div class="flex items-center justify-center gap-2 px-2">
        <div class="flex justify-between lg:hidden gap-2">
          <span class="font-bold">-</span>
          <span>Plantable</span>
          <span class="font-bold">+</span>
        </div>
        <span class="hidden lg:block text-sm leading-3">Non plantable</span>
        <div class="flex items-center gap-2">
          <score-label
            v-for="index in [0, 2, 4, 6, 8, 10]"
            :key="`plantability-${index}`"
            :clickable="true"
            :is-selected="mapStore.isFiltered(index)"
            :label="`${index}`"
            :score="index"
            class="flex items-center justify-center"
            :background-color-class="SCORE_BG_CLASSES[index]"
            @click="handleScoreClick"
          />
        </div>
        <span class="hidden lg:block text-sm leading-3">Plantable</span>
      </div>
    </div>

    <!-- Vulnerability Legend Section -->
    <div class="flex flex-col items-center gap-2">
      <div class="text-sm font-semibold text-primary-900">Vulnérabilité chaleur</div>
      <div class="flex flex-col items-center justify-center gap-2 px-2">
        <div class="flex justify-between w-full lg:justify-center">
          <span class="leading-3 text-sm">Faible</span>
          <span class="leading-3 text-sm lg:hidden">Fort</span>
        </div>

        <div class="flex items-center gap-2 flex-wrap justify-center">
          <vulnerability-score-label :index="1" name="très faible" color="#31AFF5" />
          <vulnerability-score-label :index="2" name="faible" color="#7785A3" />
          <vulnerability-score-label :index="3" name="faible à moyenne" color="#E6E3D1" />
          <vulnerability-score-label :index="4" name="moyenne" color="#D1BB3B" />
          <vulnerability-score-label :index="5" name="moyenne à élevée" color="#C06329" />
          <vulnerability-score-label :index="6" name="élevée" color="#E03F08" />
          <vulnerability-score-label :index="7" name="très élevée" color="#B61C02" />
          <vulnerability-score-label :index="8" name="critique" color="#7A0403" />
          <vulnerability-score-label :index="9" name="extrêmement critique" color="#353A47" />
        </div>
        <span class="leading-3 text-sm hidden lg:block">Fort</span>
      </div>
    </div>
  </div>
</template>
