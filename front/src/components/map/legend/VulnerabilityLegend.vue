<script lang="ts" setup>
import { VulnerabilityLegend } from "@/utils/vulnerability"
import { useMapStore } from "@/stores/map"

const mapStore = useMapStore()

const handleVulnerabilityClick = (index: number) => {
  mapStore.toggleVulnerabilityFilter(index + 1) // +1 car les indices commencent à 1
}
</script>

<template>
  <div
    class="font-accent flex flex-col items-center justify-center text-xs leading-3 gap-2"
    data-cy="vulnerability-zones-legend"
  >
    <div class="flex items-center flex-wrap justify-center gap-[7px] px-2">
      <span class="leading-3 text-sm">Faible</span>

      <div
        v-for="(color, name, index) in VulnerabilityLegend"
        :key="name"
        :class="[
          'w-[16px] md:w-[24px] lg:[32px] h-[32px] rounded-[2px] flex items-center justify-center text-white text-xs md:text-sm cursor-pointer hover:scale-110 hover:shadow-lg transition-all duration-200 ease-out transform relative',
          mapStore.isVulnerabilityFiltered(index + 1)
            ? 'ring-2 ring-primary-900 scale-105 shadow-md'
            : ''
        ]"
        :style="{ backgroundColor: color }"
        :data-vulnerability="index + 1"
        :title="`Niveau ${index + 1} - ${name} - Cliquez pour ${mapStore.isVulnerabilityFiltered(index + 1) ? 'désactiver' : 'activer'} le filtre`"
        @click="handleVulnerabilityClick(index)"
      >
        {{ index + 1 }}

        <!-- Indicateur de sélection -->
        <Transition
          enter-active-class="transition-all duration-200 ease-out"
          enter-from-class="opacity-0 scale-0"
          enter-to-class="opacity-100 scale-100"
          leave-active-class="transition-all duration-150 ease-in"
          leave-from-class="opacity-100 scale-100"
          leave-to-class="opacity-0 scale-0"
        >
          <div
            v-if="mapStore.isVulnerabilityFiltered(index + 1)"
            class="absolute -top-1 -right-1 w-3 h-3 bg-primary-600 rounded-full border border-white flex items-center justify-center"
          >
            <span class="text-white text-[8px] font-bold">✓</span>
          </div>
        </Transition>
      </div>

      <span class="leading-3 text-sm">Fort</span>
    </div>
  </div>
</template>
