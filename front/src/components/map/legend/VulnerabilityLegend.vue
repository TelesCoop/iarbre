<script lang="ts" setup>
import { VulnerabilityLegend } from "@/utils/vulnerability"
import { useMapStore } from "@/stores/map"

const mapStore = useMapStore()

const handleVulnerabilityClick = (index: number) => {
  mapStore.toggleAndApplyFilter(index) // +1 car les indices commencent à 1
}

const getVulnerabiltyIndex = (index: number) => {
  return index + 1
}
</script>

<template>
  <div
    class="font-accent flex flex-col items-center justify-center text-xs leading-3 gap-2"
    data-cy="vulnerability-zones-legend"
  >
    <div class="flex items-center flex-wrap justify-center gap-[7px] px-2">
      <span class="leading-3 text-sm">Faible</span>

      <score-label
        v-for="(color, name, index) in VulnerabilityLegend"
        :key="getVulnerabiltyIndex(index)"
        :clickable="true"
        :data-vulnerability="index"
        :is-selected="mapStore.isFiltered(getVulnerabiltyIndex(index))"
        :label="`${getVulnerabiltyIndex(index)}`"
        :score="getVulnerabiltyIndex(index)"
        :title="`Zone ${getVulnerabiltyIndex(index)} - ${name} - Cliquez pour ${mapStore.isFiltered(getVulnerabiltyIndex(index)) ? 'désactiver' : 'activer'} le filtre`"
        class="flex items-center justify-center"
        :background-color="color"
        :class="color"
        @click="() => handleVulnerabilityClick(getVulnerabiltyIndex(index))"
      />

      <span class="leading-3 text-sm">Fort</span>
    </div>
  </div>
</template>
